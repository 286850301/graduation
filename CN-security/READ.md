# 安全VPN网关配置实验集

*基于俄罗斯ГОСТ加密标准的С-Терra Шлюz安全网关综合配置实践*

## 📋 项目概述

本仓库包含7个关于使用С-Терra Шлюz安全网关配置安全VPN隧道的实践实验。实验涵盖各种拓扑结构和配置场景，包括采用ГОСТ加密的IPsec VPN、证书认证、高可用性配置和高级路由场景。

## 🎯 目标受众

- 信息网络与通信专业研究生
- 网络安全专业人员
- 对俄罗斯加密标准(ГОСТ)感兴趣的学习者
- VPN技术爱好者

## 🛠 技术栈

- **安全网关**: С-Терra Шлюz 4.3
- **加密算法**: ГОСТ标准 (ГОСТ 28147-89, ГОСТ Р 34.10-2012, ГОСТ Р 34.11-2012)
- **VPN协议**: IPsec, IKE, GRE
- **认证方式**: 预共享密钥, 数字证书
- **路由协议**: 静态路由, OSPF
- **高可用性**: VRRP, 集群
- **网络服务**: NAT, 防火墙

## 📚 实验内容

### 实验1: 基础IPsec VPN隧道
- 在两个子网间建立VPN隧道
- 预共享密钥认证
- 网关初始化和基础配置
- 基本安全策略设置

### 实验2: 证书认证迁移
- 从预共享密钥迁移到数字证书
- 证书颁发机构(CA)集成
- 防火墙流量过滤
- ГОСТ签名算法实现

### 实验3: 星型拓扑与中心重加密
- Hub-and-spoke VPN架构
- 基于证书的认证
- 通过中心节点的分支间通信
- 多隧道管理

### 实验4: Router-on-a-Stick拓扑
- 单臂网关部署
- 复杂路由场景
- NAT配置
- 基于证书的安全

### 实验5: 基于VRRP的高可用性
- 容错集群配置
- VRRP协议实现
- 源NAT配置
- 自动故障转移机制

### 实验6: GRE+OSPF负载均衡
- 多GRE隧道流量均衡
- OSPF动态路由
- 冗余路径配置
- IPsec上的GRE实现

### 实验7: VRRP与GRE/OSPF动态路由
- 带动态路由的高级高可用性
- GRE隧道与VRRP集成
- 服务启动顺序优化
- 全面故障转移测试

## 🔐 加密标准

所有实验均实现俄罗斯加密标准：
- **加密算法**: ГОСТ 28147-89 (256位密钥)
- **数字签名**: ГОСТ Р 34.10-2012 (256位密钥)
- **哈希函数**: ГОСТ Р 34.11-2012 ТК26 (256位密钥)
- **密钥交换**: VKO_GOSTR3410_2012_256

## 🏗 基础设施要求

### 硬件/软件要求
- С-Терra Шлюz安全网关(版本4.3)
- 虚拟化平台(兼容GNS3)
- 证书颁发机构服务器
- 路由设备(OpenWRT, MikroTik或FRR)
- 终端主机(Linux/Windows系统)

### 网络要求
- 设备间IP连通性
- 适当的网络分段
- 证书颁发机构访问权限

## 📁 仓库结构

```
├── 实验1-基础IPsec-VPN/
├── 实验2-证书迁移/
├── 实验3-星型拓扑/
├── 实验4-Router-on-Stick/
├── 实验5-VRRP高可用/
├── 实验6-GRE-OSPF负载均衡/
├── 实验7-VRRP-GRE-OSPF/
├── 文档资料/
└── 配置文件/
```

## 🚀 开始使用

1. **环境搭建**
   - 部署С-Терra Шлюz虚拟设备
   - 根据实验拓扑配置网络接口
   - 使用有效许可证初始化网关

2. **基础配置**
   - 按照实验1进行初始设置
   - 建立基础IP连通性
   - 配置初始安全策略

3. **高级场景**
   - 按顺序完成实验
   - 实现证书颁发机构(从实验2开始)
   - 构建复杂拓扑(实验3-7)

## 📝 关键命令

### 网关初始化
```bash
initialize
change user password
system
passwd
```

### Cisco类控制台配置
```bash
configure terminal
crypto isakmp policy 1
hash gost341112-256-tc26
authentication pre-share/gost-sig
group vko2
```

### 证书管理
```bash
cert_mgr create -subj "C=RU,OU=Study,CN=Hub" -GOST_R341012_256
cert_mgr import -f /certs/ca.cer -t
cert_mgr show
```

## 🔍 验证命令

### VPN状态检查
```bash
show crypto isakmp sa
show crypto ipsec sa
run sa_mgr show
```

### 路由和接口
```bash
show ip route
show interfaces
show vrrp
```

### 证书状态
```bash
run cert_mgr show
run cert_mgr check
```

## ⚠️ 重要说明

- 预共享密钥仅用于测试环境(生产环境请使用证书)
- 正确的时间同步对证书验证至关重要
- VRRP配置在集群节点间不会自动同步
- GRE隧道需要正确的MTU配置
- 源NAT必须排除IPsec流量

## 🎓 学习成果

完成这些实验后，学生将能够：

- 使用ГОСТ密码学配置复杂VPN基础设施
- 使用VRRP实现高可用性解决方案
- 管理用于认证的数字证书
- 设计和部署各种VPN拓扑
- 排查IPsec和路由问题
- 将动态路由与VPN隧道集成

## 📞 支持

相关问题咨询：
- 实验配置：查看对应实验文档
- С-Терra Шлюz特定问题：参考官方文档
- 网络连通性：验证IP地址和路由配置

## 📄 许可证

本教育材料仅供学术使用。在生产环境中请确保获得С-Терra Шлюz软件的适当许可。
